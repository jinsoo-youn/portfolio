+++
author = "Jinsoo Youn"
title = "4ì¥ - replicaset"
date = "2022-07-25"
description = "Liveness Probe & replicaset, daemonset, job"
tags = [
"kubernetes",
"study",
]
categories = [
"kubernetes",
"study",
]
series = ["Kubernetes-In-Action"]
aliases = ["Kubernetes-In-Action"]
image = "cover.png"
+++

Liveness probe ì‚¬ìš© ë°©ë²•ê³¼ íŒŒë“œë¥¼ ê´€ë¦¬í•˜ëŠ” ê¸°ë³¸ ë¦¬ì†ŒìŠ¤ë“¤ì„ ì•Œì•„ë³´ì
<!--more-->

ì»¨í…Œì´ë„ˆì˜ ì£¼ í”„ë¡œì„¸ìŠ¤ì— crashê°€ ë°œìƒí•œë‹¤ë©´ kubeletì´ ì»¨í…Œì´ë„ˆë¥¼ ë‹¤ì‹œ ì‹œì‘í•œë‹¤. ì–´í”Œë¦¬ì¼€ì´ì…˜ì— ë²„ê·¸ê°€ ë°œìƒí•˜ë©´ ì¿ ë²„ë„¤í‹°ìŠ¤ê°€ ìë™ìœ¼ë¡œ ë‹¤ì‹œ ì‹œì‘í•˜ê¸° ë•Œë¬¸ì— ì–´í”Œë¦¬ì¼€ì´ì…˜ ìì²´ì— íŠ¹ë³„í•œ ì‘ì—…ì„ í•˜ì§€ ì•Šì•„ë„ ì¿ ë²„ë„¤í‹°ìŠ¤ì—ì„œ ì‹¤í–‰ ì¤‘ì¸ ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ìë™ìœ¼ë¡œ ë³µêµ¬í•  ìˆ˜ ìˆë‹¤.

í•˜ì§€ë§Œ ì–´í”Œë¦¬ì¼€ì´ì…˜ì´ **ë¬´í•œ ë£¨í”„ë‚˜ êµì°© ìƒíƒœì— ë¹ ì ¸** ì‘ë‹µì„ ë©ˆì¶”ëŠ” ìƒí™©ì—ëŠ” ì–´ë–¨ê¹Œ? Crash ê°™ì€ ê²½ìš°ì—ëŠ” í”„ë¡œì„¸ìŠ¤ê°€ ê°•ì œë¡œ ì¢…ë£Œë˜ì§€ë§Œ ë¬´í•œë£¨í”„ë‚˜ êµì°© ìƒíƒœë¼ë©´ ì•„ë¬´ë„ ì•Œ ìˆ˜ê°€ ì—†ë‹¤. ê·¸ë˜ì„œ k8sì—ì„œëŠ” ë¼ì´ë¸Œë‹ˆìŠ¤ í”„ë¡œë¸Œë¥¼ ì‚¬ìš©í•´ ì»¨í…Œì´ë„ˆê°€ ì‚´ì•„ìˆëŠ” ì§€ ì—¬ë¶€ë¥¼ í™•ì¸í•œë‹¤.

# Liveness Probe

> ë¼ì´ë¸Œë‹ˆìŠ¤ í”„ë¡œë¸Œë¥¼ ì§€ì •í•´ k8sê°€ ë” ì´ìƒ ì •ìƒì ì´ì§€ ëª»í•œ ê²½ìš° ì¦‰ì‹œ ì»¨í…Œì´ë„ˆë¥¼ ì¬ì‹œì‘í•˜ê²Œ í•  ìˆ˜ ìˆë‹¤.
>

ë¼ì´ë¸Œë‹ˆìŠ¤ í”„ë¡œë¸Œë¥¼ í†µí•´ ì»¨í…Œì´ë„ˆê°€ ì•„ì§ ì‚´ì•„ìˆëŠ”ì§€ í™•ì¸í•  ìˆ˜ ìˆë‹¤. k8sëŠ” ì£¼ê¸°ì ìœ¼ë¡œ ê²€ì‚¬ë¥¼ ì‹¤í–‰í•˜ê³  ê²€ì‚¬ê°€ ì‹¤íŒ¨í•  ê²½ìš° ì»¨í…Œì´ë„ˆë¥¼ ë‹¤ì‹œ ì‹œì‘í•œë‹¤.

ì»¨í…Œì´ë„ˆ ì§„ë‹¨ì€ ì»¨í…Œì´ë„ˆê°€ êµ¬í˜„í•œ í•¸ë“¤ëŸ¬ë¥¼ kubeletì´ í˜¸ì¶œí•´ì„œ ì‹¤í–‰í•œë‹¤.

![img.png](img.png)

> ìš´ì˜ í™˜ê²½ì—ì„œ ì‹¤í–‰ ì¤‘ì¸ íŒŒë“œì˜ ê²½ìš°, í•­ìƒ ë¼ì´ë¸Œë‹ˆìŠ¤ í”„ë¡œë¸Œë¥¼ ì •ì˜í•´ì•¼ í•œë‹¤. ì •ì˜ë˜ì–´ ìˆì§€ ì•Šìœ¼ë©´ k8sëŠ” ì–´í”Œë¦¬ì¼€ì´ì…˜ì´ ì•„ì§ ì‚´ì•„ ìˆëŠ”ì§€ ì—¬ë¶€ë¥¼ ì•Œ ìˆ˜ ì—†ë‹¤.
>

k8ì—ëŠ” 3ê°€ì§€ ë°©ë²•ì˜ ë¼ì´ë¸Œë‹ˆìŠ¤ í”„ë¡œë¸Œê°€ ìˆë‹¤.

## HTTP Request

HTTP GET í”„ë¡œë¸ŒëŠ” ì§€ì •í•œ IP ì£¼ì†Œ, í¬íŠ¸, ê²½ë¡œì— HTTP GET ìš”ì²­ì„ ìˆ˜í–‰í•œë‹¤. ì‘ë‹µì´ ì˜¤ë¥˜ë¥¼ ë‚˜íƒ€ë‚´ë©´ í”„ë¡œë¸ŒëŠ” ì‹¤íŒ¨ë¡œ ê°„ì£¼í•˜ê³  ì»¨í…Œì´ë„ˆë¥¼ ì¬ì‹œì‘í•œë‹¤.

```yaml
apiVersion: v1
kind: Pod
metadata:
  labels:
    test: liveness
  name: liveness-http
spec:
  containers:
  - name: liveness
    image: k8s.gcr.io/liveness
    args:
    - /server
    livenessProbe:
      httpGet:  # HTTP Getì„ ìˆ˜í–‰í•  ë¼ì´ë¸Œë‹ˆìŠ¤ í”„ë¡œë¸Œ
        path: /healthz # ë„¤íŠ¸ì›Œí¬ í¬íŠ¸ HTTP ìš”ì²­ì—ì„œ ìš”ì²­í•  ê²½ë¡œ
        port: 8080 # í”„ë¡œë¸Œê°€ ì—°ê²°í•´ì•¼ í•˜ëŠ” ë„¤íŠ¸ì›Œí¬ í¬íŠ¸
        httpHeaders:
        - name: Custom-Header
          value: Awesome
      initialDelaySeconds: 3 # ì»¨í…Œì´ë„ˆê°€ ì‹œì‘í•˜ê³  3ì´ˆ í›„ í”„ë¡œë¸Œ ì‹œì‘
      periodSeconds: 3 # 3ì´ˆë§ˆë‹¤ í”„ë¡œë¸Œ ì‹¤í–‰
```

ì •ì˜ëœ í”„ë¡œë¸ŒëŠ” k8sì—ê²Œ ì»¨í…Œì´ë„ˆê°€ ì—¬ì „íˆ ì •ìƒì ìœ¼ë¡œ ë™ì‘í•˜ëŠ”ì§€ ì²´í¬í•˜ê¸° ìœ„í•´ '/healthz' ê²½ë¡œì˜ í¬íŠ¸ 8080 HTTP GET ìš”ì²­ì„ ì£¼ê¸°ì ìœ¼ë¡œ ìˆ˜í–‰í•˜ë„ë¡ ì•Œë ¤ì¤€ë‹¤. ì»¨í…Œì´ë„ˆ ë‚´ì—ì„œ ì‹¤í–‰ ì¤‘ì¸ ì›¹ì„œë²„ê°€ HTTP ìš”ì²­ì— ì‘ë‹µí•˜ì§€ ì•Šìœ¼ë©´ ì»¨í…Œì´ë„ˆë¥¼ ë‹¤ì‹œ ì‹œì‘í•œë‹¤.

**ë™ì‘ ì¤‘ì¸ ë¼ì´ë¸Œë‹ˆìŠ¤ í”„ë¡œë¸Œ ë³´ê¸°**

`kubectl describe` ì»¤ë§¨ë“œë¥¼ ì´ìš©í•´ ë¼ì´ë¸Œë‹ˆìŠ¤ í”„ë¡œë¸Œë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

![liveness.png](liveness.png)

`State`ë¥¼ í†µí•´ ì»¨í…Œì´ë„ˆì˜ ìƒíƒœë¥¼ í™•ì¸í•  ìˆ˜ ìˆìœ¼ë©° `Last State`ëŠ” ì§€ë‚œ ì»¨í…Œì´ë„ˆì˜ ìƒíƒœë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤. ì§€ë‚œ ì»¨í…Œì´ë„ˆê°€ ìˆëŠ” ì´ìœ ëŠ” ì»¨í…Œì´ë„ˆê°€ ë¬¸ì œê°€ ìƒê²¨ ê°•ì œ ì¢…ë£Œí•˜ê³  ë‹¤ì‹œ ìƒì„±í–ˆê¸° ë•Œë¬¸ì´ë‹¤.

ë˜í•œ `Liveness`ë¥¼ í†µí•´ ë¼ì´ë¸Œë‹ˆìŠ¤ í”„ë¡œë¸Œì˜ ì •ë³´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤. ì»¨í…Œì´ë„ˆê°€ ì‹¤í–‰ë˜ê³  3ì´ˆ(delay) ì´í›„ í”„ë¡œë¸Œë¥¼ ì‹œì‘í•˜ë©° ìš”ì²­ì‹œ 1ì´ˆ(timeout) ì´ë‚´ì— ì‘ë‹µì„ í•´ì•¼ í•œë‹¤. ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ ì‹¤íŒ¨í•œë‹¤. 3ì´ˆ ë§ˆë‹¤(period) HTTP GET ìš”ì²­ì„ í•˜ë©° ì—°ì†ìœ¼ë¡œ 3ë²ˆ ì‹¤íŒ¨(failure)í•˜ë©´ kubeletì´ í•´ë‹¹ ì»¨í…Œì´ë„ˆë¥¼ ì¬ì‹œì‘ì‹œí‚¨ë‹¤.

## TCP Socket

ì»¨í…Œì´ë„ˆì˜ ì§€ì •ëœ í¬íŠ¸ì— TCPë¥¼ ì—°ê²°í•˜ë ¤ê³  ì‹œë„í•œë‹¤. ì„±ê³µì ìœ¼ë¡œ ì—°ê²°ë˜ë©´ í”„ë¡œë¸Œê°€ ì„±ê³µí•œ ê²ƒì´ê³ , ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ ì»¨í…Œì´ë„ˆê°€ ì¬ì‹œì‘í•œë‹¤.

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: goproxy
  labels:
    app: goproxy
spec:
  containers:
  - name: goproxy
    image: k8s.gcr.io/goproxy:0.1
    ports:
    - containerPort: 8080
    livenessProbe:
      tcpSocket:
        port: 8080
      initialDelaySeconds: 15
      periodSeconds: 20

```

TCP Socketì„ í†µí•œ í”„ë¡œë¸ŒëŠ” HTTP Request í”„ë¡œë¸Œì™€ ë¹„ìŠ·í•˜ë‹¤.

## Exec Command

ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì— ì„ì˜ì˜ ëª…ë ¹ì„ ì‹¤í–‰í•˜ê³  ëª…ë ¹ì˜ ì¢…ë£Œ ìƒíƒœ ì½”ë“œë¥¼ í™•ì¸í•œë‹¤. ìƒíƒœ ì½”ë“œê°€ 0ì´ë©´ ê²€ì‚¬ê°€ ì„±ê³µí•œ ê²ƒì´ê³ , ë‹¤ë¥¸ ëª¨ë“  ì½”ë“œëŠ” ì˜¤ë¥˜ë¡œ ê°„ì£¼ëœë‹¤.

```yaml
apiVersion: v1
kind: Pod
metadata:
  labels:
    test: liveness
  name: liveness-exec
spec:
  containers:
  - name: liveness
    image: k8s.gcr.io/busybox
    args:
    - /bin/sh
    - -c
    - touch /tmp/healthy; sleep 30; rm -f /tmp/healthy; sleep 600
    livenessProbe:
      exec:
        command:
        - cat
        - /tmp/healthy
      initialDelaySeconds: 5
      periodSeconds: 5

```

kubeletì´ initialDelaySeconds, periodSecondsë¥¼ ê³ ë ¤í•´ `cat /tmp/healthy` ëª…ë ¹ì–´ë¥¼ ìˆ˜í–‰í•œë‹¤. ì»¨í…Œì´ë„ˆì˜ `args`ë¥¼ ë³´ë©´ ë‚´ë¶€ì ìœ¼ë¡œ í•´ë‹¹ ë¹ˆ íŒŒì¼ì„ ë§Œë“¤ê³  ì‚­ì œí•˜ê¸° ë•Œë¬¸ì— ë§Œì¼ ì‚­ì œê°€ ë˜ë©´ ë¼ì´ë¸Œë‹ˆìŠ¤ í”„ë¡œë¸ŒëŠ” ì‹¤íŒ¨ë¥¼ ì˜ë¯¸í•œë‹¤. kubeletì€ ì§€ì†ì ìœ¼ë¡œ ì»¤ë§¨ë“œë¥¼ ë³´ë‚´ëŠ”ë° íŒŒì¼ì´ ì—†ìœ¼ë©´ ì»¨í…Œì´ë„ˆê°€ ë¹„ì •ìƒì ì´ë¼ëŠ” ê²ƒìœ¼ë¡œ íŒë‹¨í•œë‹¤.

**References**

- [ì±… | Kubernetes in Action 4ì¥](http://www.yes24.com/Product/Goods/89607047)
- [Kubernetes | Configure Liveness, Readiness and Startup Probes](https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/)
- [timewizhan | Liveness & Readiness Probe](https://timewizhan.tistory.com/entry/Kubernetes-Liveness-Readiness-Probe)

---

**ì»¨íŠ¸ë¡¤ëŸ¬**ëŠ” íŒŒë“œë“¤ì„ ê´€ë¦¬í•˜ëŠ” ì—­í• ì„ í•œë‹¤. ì»¨íŠ¸ë¡¤ëŸ¬ì—ëŠ” ReplicaSet, DeamonSet,  Job, CronJob, Deployment, StatefulSet ë“±ì´ ìˆë‹¤

# ReplicaSet

> íŒŒë“œë¥¼ ë‹¨ë…ìœ¼ë¡œ ë§Œë“¤ë©´ íŒŒë“œì— ë¬¸ì œê°€ ìƒê²¼ì„ ë•Œ ìë™ìœ¼ë¡œ ë³µêµ¬ë˜ì§€ ì•ŠëŠ”ë‹¤. ì´ëŸ¬í•œ íŒŒë“œë¥¼ ì •í•´ì§„ ìˆ˜ë§Œí¼ ë³µì œí•˜ê³  ê´€ë¦¬í•˜ëŠ” ê²ƒì´ ë ˆí”Œë¦¬ì¹´ì…‹ì´ë‹¤. ë ˆí”Œë¦¬ì¹´ì…‹ì€ ì›í•˜ëŠ” ê°œìˆ˜ì˜ íŒŒë“œë¥¼ ìœ ì§€í•œë‹¤.
>

![rs.png](rs.png)

ì¼ë°˜ì ìœ¼ë¡œ ë ˆí”Œë¦¬ì¹´ì…‹ì„ ì§ì ‘ ìƒì„±í•˜ì§€ëŠ” ì•ŠëŠ”ë‹¤. ê·¸ ëŒ€ì‹  ìƒìœ„ ìˆ˜ì¤€ì˜ ë””í”Œë¡œì´ë¨¼íŠ¸ ë¦¬ì†ŒìŠ¤ë¥¼ ë§Œë“¤ ë•Œ ìë™ìœ¼ë¡œ ìƒì„±í•œë‹¤.

**ğŸ§© ë ˆí”Œë¦¬ì¹´ì…‹ ì‘ì„±**

```yaml
# frontend.yaml
apiVersion: apps/v1
kind: ReplicaSet
metadata:
  name: frontend
  labels:
    app: guestbook
    tier: frontend
spec:
  replicas: 3 # ì›í•˜ëŠ” íŒŒë“œ ê°œìˆ˜. ê¸°ë³¸ê°’ì€ 1
  selector: # ë¼ë²¨ ì²´í¬ ì¡°ê±´. ì–´ë–¤ ë ˆì´ë¸”ì˜ íŒŒë“œë¥¼ ì„ íƒí•´ì„œ ê´€ë¦¬í• ì§€ ì„¤ì •
    matchLabels:
      tier: frontend
  template: # ìƒì„±í•  íŒŒë“œ ëª…ì„¸
    metadata:
      labels:
        tier: frontend
    spec:
      containers: # ì»¨í…Œì´ë„ˆ ëª…ì„¸
      - name: php-redis
        image: gcr.io/google_samples/gb-frontend:v3

```

ë¼ë²¨ì„ ì²´í¬í•´ì„œ ì›í•˜ëŠ” ìˆ˜ì˜ íŒŒë“œê°€ ì—†ìœ¼ë©´ ìƒˆë¡œìš´ íŒŒë“œë¥¼ ìƒì„±í•œë‹¤.

**ğŸ§© ë ˆí”Œë¦¬ì¹´ì…‹ ìƒì„±**
ì´ ë§¤ë‹ˆí˜ìŠ¤íŠ¸ë¥¼ frontend.yamlì— ì €ì¥í•˜ê³  ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ì— ì ìš©í•˜ë©´ ì •ì˜ë˜ì–´ ìˆëŠ” ë ˆí”Œë¦¬ì¹´ì…‹ì´ ìƒì„±ë˜ê³  ë ˆí”Œë¦¬ì¹´ì…‹ì´ ê´€ë¦¬í•˜ëŠ” íŒŒë“œê°€ ìƒì„±ëœë‹¤.

```
# ë ˆí”Œë¦¬ì¹´ì…‹ ìƒì„±
$ kubectl apply -f frontend.yaml
```

**ğŸ§© ë ˆí”Œë¦¬ì¹´ì…‹ í™•ì¸**
í˜„ì¬ ë°°í¬ëœ ë ˆí”Œë¦¬ì¹´ì…‹ì„ í™•ì¸í•  ìˆ˜ ìˆìœ¼ë©° ìƒì„±ëœ frontendë¥¼ ë³¼ ìˆ˜ ìˆë‹¤.

```
# ë¦¬ì†ŒìŠ¤ í™•ì¸
$ kubectl get rs

NAME       DESIRED   CURRENT   READY   AGE
frontend   3         3         3       6s
```

- `DISIRED` : ë ˆí”Œë¦¬ì¹´ì…‹ ì„¤ì •ì— ì§€ì •í•œ íŒŒë“œ ê°œìˆ˜
- `CURRENT` : ë ˆí”Œë¦¬ì¹´ì…‹ì„ ì´ìš©í•´ í˜„ì¬ í´ëŸ¬ìŠ¤í„°ì—ì„œ ë™ì‘í•˜ëŠ” ì‹¤ì œ íŒŒë“œ ê°œìˆ˜
- `READY` : ì‚¬ìš©í•  ì¤€ë¹„ê°€ ì™„ë£Œëœ íŒŒë“œì˜ ê°œìˆ˜

ë˜í•œ ë ˆí”Œë¦¬ì¹´ì…‹ì˜ ìƒíƒœë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤. ì¶œë ¥ì€ ë‹¤ìŒê³¼ ìœ ì‚¬í•  ê²ƒì´ë‹¤.

```
$ kubectl describe rs/frontend
```

```
Name:         frontend
Namespace:    default
Selector:     tier=frontend
Labels:       app=guestbook
              tier=frontend
Annotations:  kubectl.kubernetes.io/last-applied-configuration:
                {"apiVersion":"apps/v1","kind":"ReplicaSet","metadata":{"annotations":{},"labels":{"app":"guestbook","tier":"frontend"},"name":"frontend",...
Replicas:     3 current / 3 desired
Pods Status:  3 Running / 0 Waiting / 0 Succeeded / 0 Failed
Pod Template:
  Labels:  tier=frontend
  Containers:
   php-redis:
    Image:        gcr.io/google_samples/gb-frontend:v3
    Port:         <none>
    Host Port:    <none>
    Environment:  <none>
    Mounts:       <none>
  Volumes:        <none>
Events:
  Type    Reason            Age   From                   Message
  ----    ------            ----  ----                   -------
  Normal  SuccessfulCreate  117s  replicaset-controller  Created pod: frontend-wtsmm
  Normal  SuccessfulCreate  116s  replicaset-controller  Created pod: frontend-b2zdv
  Normal  SuccessfulCreate  116s  replicaset-controller  Created pod: frontend-vcmts

```

**ğŸ§© íŒŒë“œ í™•ì¸**
í˜„ì¬ íŒŒë“œ ì •ë³´ë¥¼ í™•ì¸í•œë‹¤.

```
# íŒŒë“œ í™•ì¸
$ kubectl get pods

NAME             READY   STATUS    RESTARTS   AGE
frontend-b2zdv   1/1     Running   0          6m36s
frontend-vcmts   1/1     Running   0          6m36s
frontend-wtsmm   1/1     Running   0          6m36s
```

`.spec.replicas`ë¥¼ 3ìœ¼ë¡œ ì„¤ì •í–ˆê¸° ë•Œë¬¸ì— frontend-b2zdv, frontend-vcmts, frontend-wtsmmë¼ëŠ” íŒŒë“œê°€ ì‹¤í–‰ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

**ğŸ§© ë ˆí”Œë¦¬ì¹´ì…‹ ì‚­ì œ**
ë ˆí”Œë¦¬ì¹´ì…‹ì„ ì‚­ì œí•œë‹¤. ë ˆí”Œë¦¬ì¹´ì…‹ì„ ì‚­ì œí•˜ë©´ ê´€ë ¨ íŒŒë“œë„ ëª¨ë‘ ì‚­ì œëœë‹¤.

```
$ kubectl delete rs frontend
```

**References**

- [ì±… | Kubernetes in Action 4ì¥](http://www.yes24.com/Product/Goods/89607047)
- [Kubernetes | ë ˆí”Œë¦¬ì¹´ì…‹](https://kubernetes.io/ko/docs/concepts/workloads/controllers/replicaset/)

---

# DaemonSet

> ë°ëª¬ì…‹ì€ í´ëŸ¬ìŠ¤í„° ì „ì²´ ë…¸ë“œì— íŠ¹ì • íŒŒë“œë¥¼ ì‹¤í–‰í•  ë•Œ ì‚¬ìš©í•˜ëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ë‹¤. í´ëŸ¬ìŠ¤í„° ì•ˆì— ìƒˆë¡­ê²Œ ë…¸ë“œê°€ ì¶”ê°€ë˜ì—ˆì„ ë•Œ ë°ëª¬ì…‹ì´ ìë™ìœ¼ë¡œ í•´ë‹¹ ë…¸ë“œì— íŒŒë“œë¥¼ ì‹¤í–‰ì‹œí‚¨ë‹¤.
>

**ğŸ” ì»¨íŠ¸ë¡¤ëŸ¬**: ê¸°ë³¸ ì˜¤ë¸Œì íŠ¸ë¥¼ ìƒì„±í•˜ê³  ì´ë¥¼ ê´€ë¦¬í•˜ëŠ” ì—­í• ë¡œ, ëŒ€í‘œì ìœ¼ë¡œ ReplicaSet, DeamonSet, StatefulSet, Job, Deployment ë“±ì´ ìˆë‹¤.

![daemonset](daemonset.png)

ë°ëª¬ì…‹ì€ ë…¸ë“œê°€ ìˆëŠ” ìˆ˜ë§Œí¼ íŒŒë“œë¥¼ ìƒì„±í•˜ê³  ê° ë…¸ë“œì— íŒŒë“œë¥¼ í•˜ë‚˜ì”© ë°°í¬í•œë‹¤. ë…¸ë“œê°€ ë‹¤ìš´ë¼ë„ ë°ëª¬ì…‹ì€ ì–´ëŠ ê³³ì—ì„œë„ íŒŒë“œë¥¼ ìƒì„±í•˜ì§€ ì•ŠëŠ”ë‹¤. ì¦‰, ë…¸ë“œê°€ í´ëŸ¬ìŠ¤í„°ì—ì„œ ë¹ ì¡Œì„ ë•ŒëŠ” í•´ë‹¹ ë…¸ë“œì— ìˆë˜ íŒŒë“œëŠ” ê·¸ëŒ€ë¡œ ì‚¬ë¼ì§ˆ ë¿ ë‹¤ë¥¸ ê³³ìœ¼ë¡œ ì˜®ê²¨ê°€ì„œ ì‹¤í–‰ë˜ê±°ë‚˜ í•˜ì§€ ì•ŠëŠ”ë‹¤.

ëª¨ë“  ë…¸ë“œì— íŒŒë“œë¥¼ í•˜ë‚˜ì”© ë°°í¬í•˜ì§€ ì•Šì•„ë„ ëœë‹¤. í…Œì¸íŠ¸ì™€ í†¨ëŸ¬ë ˆì´ì…˜ ì˜µì…˜ì„ ì‚¬ìš©í•˜ë©´ ë°ëª¬ì…‹ì„ ì „ì²´ í´ëŸ¬ìŠ¤í„°ì˜ ë…¸ë“œê°€ ì•„ë‹ˆë¼ íŠ¹ì • ë…¸ë“œë“¤ì—ë§Œ ì„ íƒí•´ì„œ ì‹¤í–‰í•  ìˆ˜ë„ ìˆë‹¤.

> ë°ëª¬ì…‹ì€ ë³´í†µ ë¡œê·¸ ìˆ˜ì§‘ê¸°ë¥¼ ì‹¤í–‰í•˜ê±°ë‚˜ ë…¸ë“œë¥¼ ëª¨ë‹ˆí„°ë§í•˜ëŠ” ë°ëª¬ ë“± í´ëŸ¬ìŠ¤í„° ì „ì²´ì— í•­ìƒ ì‹¤í–‰í•´ë‘ì–´ì•¼ í•˜ëŠ” íŒŒë“œì— ì‚¬ìš©í•œë‹¤.
>

## ë°ëª¬ì…‹ ìƒì„±

```yaml
apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: myapp-ds
spec:
  selector:
    matchLabels:
      app: myapp-ds
  template:
    metadata:
      labels:
        app: myapp-ds
    spec:
      nodeSelector:
        node: development
      containers:
      - name: myapp
        image: ghcr.io/c1t1d0s7/go-myweb
        ports:
        - containerPort: 8080
```

ğŸ” **.spec.template.spec.nodeSelector**: íŒŒë“œë¥¼ íŠ¹ì • ë…¸ë“œì— ë°°ì¹˜í•œë‹¤. ë…¸ë“œì˜ ë¼ë²¨ ì…€ë ‰í„° í•„ë“œëŠ” ë ˆí”Œë¦¬ì¹´ì…‹, ë°ëª¬ì¡, ì¡, ë””í”Œë¡œì´ë¨¼íŠ¸ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œë„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

## ë°ëª¬ì…‹ í™•ì¸

```
# ë°ëª¬ì…‹ í™•ì¸
$ kubectl get ds
```

```
$ kubectl get po
No resources found.
```

DISIRED, CURRENT, READY ë“±ì´ ëª¨ë‘ 0ìœ¼ë¡œ ë³´ì¸ë‹¤. íŒŒë“œ ëª©ë¡ì„ ë‚˜ì—´í•˜ëŠ” ì»¤ë§¨ë“œë¥¼ ì…ë ¥í•´ë„ ë§ˆì°¬ê°€ì§€ë‹¤. íŒŒë“œê°€ ìƒì„±ë˜ì§€ ì•ŠëŠ”ë‹¤. ì™œ ê·¸ëŸ´ê¹Œ?

ë°ëª¬ì…‹ ì •ì˜ì— ë…¸ë“œì…€ë ‰í„°ë¡œ `node=development` ë ˆì´ë¸”ì„ ì„ íƒí•˜ë„ë¡ ì •ì˜í•˜ì˜€ê¸° ë•Œë¬¸ì— ë…¸ë“œ ë ˆì´ë¸”ê³¼ ë§¤ì¹­ë˜ëŠ” ë…¸ë“œê°€ ì—†ì–´ì„œ íŒŒë“œë¥¼ ìƒì„±í•˜ì§€ ì•ŠëŠ”ë‹¤.

## ë…¸ë“œ ë ˆì´ë¸” ì§€ì •

ë°ëª¬ì…‹ì´ íŒŒë“œë¥¼ ìƒì„±í•˜ê¸° ìœ„í•´ ë…¸ë“œì— ë ˆì´ë¸”ì„ ì¶”ê°€í•œë‹¤. kube-node1 ë…¸ë“œì— node=development ë…¸ë“œ ë ˆì´ë¸”ì„ ì„¤ì •í•œë‹¤.

```
$ kubectl label nodes kube-node1 node=development
node/kube-node1 labeled
```

## DaemonSet vs ReplicaSet

`ë ˆí”Œë¦¬ì¹´ì…‹`ì€ ë§¤ë‹ˆí˜ìŠ¤íŠ¸ íŒŒì¼ì— ì •ì˜ëœ íŒŒë“œì˜ ìˆ˜ê°€ í´ëŸ¬ìŠ¤í„°ì—ì„œ í•­ìƒ ì‹¤í–‰ë˜ë„ë¡ í•˜ì§€ë§Œ `ë°ëª¬ì…‹`ì€ ë§¤ë‹ˆí˜ìŠ¤íŠ¸ì— ì •ì˜ëœ í•˜ë‚˜ì˜ íŒŒë“œ ë³µì‚¬ë³¸ì´ ëª¨ë“  ë…¸ë“œì— í•˜ë‚˜ì”© ì‹¤í–‰ë˜ë„ë¡ í•œë‹¤.

ë ˆí”Œë¦¬ì¹´ì…‹ì€ í´ëŸ¬ìŠ¤í„°ì— ì›í•˜ëŠ” ìˆ˜ì˜ íŒŒë“œ ë³µì œë³¸ì´ ìˆëŠ”ì§€ í™•ì¸í•˜ëŠ” ë°˜ë©´, ë°ëª¬ì…‹ì—ëŠ” ì›í•˜ëŠ” ë ˆí”Œë¦¬ì¹´ ìˆ˜ì˜ ê°œë…ì´ ì—†ë‹¤. íŒŒë“œ ì…€ë ‰í„°ì™€ ì¼ì¹˜í•˜ëŠ” íŒŒë“œê°€ ê° ë…¸ë“œì—ì„œ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•˜ëŠ” ê²ƒ ìì²´ê°€ ë°ëª¬ì…‹ì´ ìˆ˜í–‰í•´ì•¼í•  ì—­í• ì´ë‹¤.

![daemon_rs](daemon_rs.png)

> ì¦‰, ë ˆí”Œë¦¬ì¹´ì…‹ì€ íŒŒë“œë¥¼ ì„ì˜ì˜ í´ëŸ¬ìŠ¤í„° ë…¸ë“œë¡œ ìŠ¤ì¼€ì¤„í•˜ëŠ” ë°˜ë©´, ë°ëª¬ì…‹ì€ ëª¨ë“  ë…¸ë“œì— ë°ëª¬ì…‹ì—ì„œ ì •ì˜í•œ íŒŒë“œì˜ ë‹¨ì¼ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì‹¤í–‰í•œë‹¤.
>

**References**

- [ì±… | Kubernetes in Action 4ì¥](http://www.yes24.com/Product/Goods/89607047)
- [Kubernetes | ë°ëª¬ì…‹](https://kubernetes.io/ko/docs/concepts/workloads/controllers/daemonset/)
- [kimjingo | ë°ëª¬ì…‹](https://kimjingo.tistory.com/134)
- [nearhome | ë°ëª¬ì…‹ì´ë€](https://nearhome.tistory.com/91)

---

`ë ˆí”Œë¦¬ì¹´ì…‹`ê³¼ `ë°ëª¬ì…‹`ì€ ì‘ì—…ì˜ ì™„ë£Œë¥¼ ê³ ë ¤í•˜ì§€ ì•Šê³  ê³„ì† í…ŒìŠ¤í¬ë¥¼ ì‹¤í–‰í•œë‹¤. ì´ëŸ° íŒŒë“œì˜ í”„ë¡œì„¸ìŠ¤ëŠ” ì¢…ë£Œë˜ë©´ ë‹¤ì‹œ ì‹œì‘ëœë‹¤. ê·¸ëŸ¬ë‚˜ ì™„ë£Œ ê°€ëŠ¥í•œ íƒœìŠ¤í¬ì—ì„œëŠ” í”„ë¡œì„¸ìŠ¤ê°€ ì¢…ë£Œëœ í›„ ë‹¤ì‹œ ì‹œì‘í•˜ë©´ ì•ˆëœë‹¤.

# Job

![job](job.png)

**ğŸ” ì»¨íŠ¸ë¡¤ëŸ¬**: ê¸°ë³¸ ì˜¤ë¸Œì íŠ¸ë¥¼ ìƒì„±í•˜ê³  ì´ë¥¼ ê´€ë¦¬í•˜ëŠ” ì—­í• ë¡œ, ëŒ€í‘œì ìœ¼ë¡œ ReplicaSet, DeamonSet, StatefulSet, Job, Deployment ë“±ì´ ìˆë‹¤.

> ì¡ì€ í•˜ë‚˜ ì´ìƒì˜ íŒŒë“œë¥¼ ì§€ì •í•˜ê³  ì§€ì •ëœ ìˆ˜ì˜ íŒŒë“œë¥¼ ì„±ê³µì ìœ¼ë¡œ ì‹¤í–‰í•˜ê³  ì¢…ë£Œí•˜ë„ë¡ í•œë‹¤. ì¦‰, ë‚´ë¶€ì—ì„œ ì‹¤í–‰ì¤‘ì¸ í”„ë¡œì„¸ìŠ¤ê°€ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ë©´ ì»¨í…Œì´ë„ˆê°€ ë‹¤ì‹œ ì‹œì‘ë˜ì§€ ì•Šë„ë¡ í•˜ëŠ” íŒŒë“œë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆë‹¤.
>

ë°±ì—…ì´ë‚˜ íŠ¹ì • ë°°ì¹˜ íŒŒì¼ë“¤ì²˜ëŸ¼ **í•œë²ˆ ì‹¤í–‰í•˜ê³  ì¢…ë£Œë˜ëŠ” ì„±ê²©ì˜ ì‘ì—…ì— ì‚¬ìš©**ë  ìˆ˜ ìˆë‹¤.

ë…¸ë“œ ì¥ì• ê°€ ë°œìƒí•˜ë©´ ì¡ì´ ê´€ë¦¬í•˜ëŠ” í•´ë‹¹ ë…¸ë“œì˜ íŒŒë“œëŠ” ë ˆí”Œë¦¬ì¹´ì…‹ì˜ íŒŒë“œì™€ ê°™ì€ ë°©ì‹ìœ¼ë¡œ ë‹¤ë¥¸ ë…¸ë“œë¡œ ì¬ìŠ¤ì¼€ì¤„ëœë‹¤. ì¡ì€ í”„ë¡œì„¸ìŠ¤ ìì²´ì— ì˜¤ë¥˜ê°€ ë°œìƒí•œ ê²½ìš° ì»¨í…Œì´ë„ˆë¥¼ ë‹¤ì‹œ ì‹œì‘í•˜ë„ë¡ êµ¬ì„±í•  ìˆ˜ ìˆë‹¤.

![job-managing](job-managing.png)

## ë¦¬ì†ŒìŠ¤ ì •ì˜

```yaml
apiVersion: batch/v1 # ì¡ì€ batch api ê·¸ë£¹ì˜ ë²„ì „ v1ì— ìˆë‹¤
kind: Job
metadata:
  name: pi
spec:
  template:
    spec:
      containers:
      - name: pi
        image: perl
        command: ["perl",  "-Mbignum=bpi", "-wle", "print bpi(2000)"]
      restartPolicy: Never # íŒŒë“œì˜ ì¬ì‹œì‘ ì •ì±… ì„¤ì •
  backoffLimit: 4 # ì¬ì‹œë„ íšŸìˆ˜ ì„¤ì •
  activeDeadlineSeconds: 100 # íŒŒë“œì˜ ì‹¤í–‰ì‹œê°„ ì„¤ì •
```

íŒŒì´(Ï€)ì˜ 2000ìë¦¬ê¹Œì§€ ê³„ì‚°í•´ì„œ ì¶œë ¥í•œë‹¤.

**ğŸ” restartPolicy ì˜µì…˜**: íŒŒë“œì˜ ì¬ì‹œì‘ ì •ì±…ì„ ì„¤ì •í•œë‹¤.

- always: í•­ìƒ ì¬ì‹œì‘í•œë‹¤. ê¸°ë³¸ê°’ì´ì§€ë§Œ, ì¡ íŒŒë“œëŠ” ë¬´ì œí•œ ì‹¤í–‰í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ê¸°ë³¸ ì •ì±…ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤. (ì‚¬ìš©í•  ê²½ìš°ì— ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤.) restartPolicy ì •ì±…ì„ onFailureë‚˜ Neverë¡œ ëª…ì‹œí•´ì•¼ í•œë‹¤.
- onFailure: ë¹„ì •ìƒ ì¢…ë£Œ ë°œìƒ ì‹œ ì»¨í…Œì´ë„ˆë¥¼ ì¬ì‹œì‘í•œë‹¤.
- Never: ì¬ì‹œì‘í•˜ì§€ ì•ŠëŠ”ë‹¤.

**ğŸ” backoffLimit ì˜µì…˜**: ì¡ì— ì‹¤íŒ¨í•  ê²½ìš° ë‹¤ì‹œ ì‹¤í–‰ì‹œí‚¬ ì¬ì‹œë„ íšŸìˆ˜ë¥¼ ì§€ì •í•œë‹¤. ê¸°ë³¸ê°’ì€ 6ì´ë‹¤. ë³´í†µ ì¡ ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ì¬ì‹œì‘ì„ ê´€ë¦¬í•  ë–„ë§ˆë‹¤ ì‹œê°„ ê°„ê²©ì„ ëŠ˜ë¦°ë‹¤. ì²˜ìŒ ì¬ì‹œì‘ ì‹¤íŒ¨í›„ 10ì´ˆë¥¼ ê¸°ë‹¤ë¦° í›„ ì‹œë„í•˜ê³  ê·¸ ë‹¤ìŒì€ 20ì´ˆ, 40ì´ˆ ì´ëŸ° ë°©ì‹ìœ¼ë¡œ ê³„ì† ì¬ì‹œì‘ ëŒ€ê¸° ì‹œê°„ì„ ëŠ˜ë¦°ë‹¤.

**ğŸ” activeDeadlineSeconds ì˜µì…˜**: íŒŒë“œì˜ ì‹¤í–‰ ì‹œê°„ì„ ì§€ì •í•œë‹¤. íŒŒë“œê°€ ì´ë³´ë‹¤ ì˜¤ë˜ ì‹¤í–‰ë˜ë©´ ì‹œìŠ¤í…œì€ íŒŒë“œë¥¼ ì¢…ë£Œí•˜ë ¤ê³  ì‹œë„í•˜ê³  ì¡ì„ ì‹¤íŒ¨í•œ ê²ƒìœ¼ë¡œ í‘œì‹œí•œë‹¤.

## ë¦¬ì†ŒìŠ¤ ìƒì„±

```
$ kubectl apply -f job.yaml
```

## ë¦¬ì†ŒìŠ¤ í™•ì¸

```
$ kubectl describe jobs/pi
Name:           pi
Namespace:      default
Selector:       controller-uid=c9948307-e56d-4b5d-8302-ae2d7b7da67c
Labels:         controller-uid=c9948307-e56d-4b5d-8302-ae2d7b7da67c
                job-name=pi
Annotations:    kubectl.kubernetes.io/last-applied-configuration:
                  {"apiVersion":"batch/v1","kind":"Job","metadata":{"annotations":{},"name":"pi","namespace":"default"},"spec":{"backoffLimit":4,"template":...
Parallelism:    1
Completions:    1
Start Time:     Mon, 02 Dec 2019 15:20:11 +0200
Completed At:   Mon, 02 Dec 2019 15:21:16 +0200
Duration:       65s
Pods Statuses:  0 Running / 1 Succeeded / 0 Failed
Pod Template:
  Labels:  controller-uid=c9948307-e56d-4b5d-8302-ae2d7b7da67c
           job-name=pi
  Containers:
   pi:
    Image:      perl
    Port:       <none>
    Host Port:  <none>
    Command:
      perl
      -Mbignum=bpi
      -wle
      print bpi(2000)
    Environment:  <none>
    Mounts:       <none>
  Volumes:        <none>
Events:
  Type    Reason            Age   From            Message
  ----    ------            ----  ----            -------
  Normal  SuccessfulCreate  14m   job-controller  Created pod: pi-5rwd7
```

ìœ„ì™€ ê°™ì´ `Start Time`, `Completed At`, `Duration`, `Pod Statuses` í•­ëª©ì„ ë³´ë©´ 65ì´ˆ ë™ì•ˆ íŒŒë“œë¥¼ ì„±ê³µì ìœ¼ë¡œ ì‹¤í–‰í•˜ê³  ì •ìƒì ìœ¼ë¡œ ì¢…ë£Œí–ˆë‹¤ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

```
# ì›ì£¼ìšœ ê³„ì‚° ê²°ê³¼ í™•ì¸
$ kubectl logs pi-5rwd7

3.14159265358979323846264338327950288419716939937510582097494459230781640628620...
```

## ë‹¤ìˆ˜ì˜ íŒŒë“œ ì‹¤í–‰

ì¡ì€ ë‘ ê°œ ì´ìƒì˜ íŒŒë“œ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë§Œë“¤ê³  **ë³‘ë ¬ ë˜ëŠ” ìˆœì°¨ì ìœ¼ë¡œ ì‹¤í–‰**í•˜ë„ë¡ êµ¬ì„±í•  ìˆ˜ ìˆë‹¤. ì¡ ìŠ¤í™ì˜ `completions`ì™€ `parallelism` ì†ì„±ì„ ì„¤ì •í•´ ìˆ˜í–‰í•œë‹¤.

### .spec.completions

ì •ìƒì ìœ¼ë¡œ **ì‹¤í–‰ ì¢…ë£Œë˜ì–´ì•¼ í•˜ëŠ” íŒŒë“œ ê°œìˆ˜**ë¥¼ ì •ì˜í•œë‹¤. ê¸°ë³¸ê°’ì€ 1ì´ë‹¤.

```yaml
apiVersion: batch/v1
kind: Job
metadata:
  name: myjob
spec:
  completions: 5 # ì‹¤í–‰ ì¢…ë£Œë˜ì–´ì•¼ í•˜ëŠ” íŒŒë“œ ìˆ˜ ì„¤ì •
  template:
    spec:
      ...
```

ì´ ì¡ì€ ë‹¤ì„¯ ê°œì˜ íŒŒë“œë¥¼ ì°¨ë¡€ëŒ€ë¡œ ì‹¤í–‰í•œë‹¤. ì²˜ìŒì—ëŠ” í•˜ë‚˜ì˜ íŒŒë“œë¥¼ ë§Œë“¤ê³  íŒŒë“œ ì»¨í…Œì´ë„ˆê°€ ì™„ë£Œë˜ë©´ ë‘ ë²ˆì§¸ íŒŒë“œë¥¼ ë§Œë“¤ê³  ë‹¤ì„¯ ê°œì˜ íŒŒë“œê°€ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë  ë•Œê¹Œì§€ ê³„ì†í•œë‹¤. íŒŒë“œ ì¤‘ í•˜ë‚˜ê°€ ì‹¤íŒ¨í•˜ë©´ ì¡ì´ ìƒˆ íŒŒë“œë¥¼ ìƒì„±í•˜ê¸° ë•Œë¬¸ì— ì „ì²´ì ìœ¼ë¡œ ë³´ë©´ ë‹¤ì„¯ ê°œ ì´ìƒì˜ íŒŒë“œë¥¼ ìƒì„±í•  ìˆ˜ ìˆë‹¤.

### .spec.parallelism

**ë™ì‹œì— ëª‡ ê°œì˜ íŒŒë“œê°€ ì‹¤í–‰**ë˜ì–´ë„ ê´œì°®ì€ì§€ë¥¼ ì •ì˜í•œë‹¤. ê¸°ë³¸ê°’ì€ 1ì´ê³  0ìœ¼ë¡œ ì„¤ì •í•˜ë©´ ì¡ì„ ì •ì§€í•  ìˆ˜ ìˆë‹¤.

```yaml
apiVersion: batch/v1
kind: Job
metadata:
  name: myjob
spec:
  completions: 5
  parallelism: 2 # ì¡ ë³‘ë ¬ì„± ê´€ë¦¬
  template:
    spec:
      ...
```

ì´ ì¡ì€ 2ê°œì˜ íŒŒë“œë¥¼ ë§Œë“¤ì–´ **ë³‘ë ¬ë¡œ ì‹¤í–‰**í•˜ë©° 5ê°œì˜ íŒŒë“œë¥¼ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œí•´ì•¼ í•œë‹¤. ê·¸ ì¤‘ í•˜ë‚˜ê°€ ëë‚˜ë©´ ì¡ì€ ë‹¤ì„¯ ê°œì˜ íŒŒë“œê°€ ì„±ê³µì ìœ¼ë¡œ ëë‚  ë•Œê¹Œì§€ ë‹¤ìŒ íŒŒë“œë¥¼ ì‹¤í–‰í•œë‹¤.

## ì¡ ì¢…ë£Œ

ì¡ì´ ì •ìƒì ìœ¼ë¡œ ì‹¤í–‰ ì¢…ë£Œë˜ë©´ íŒŒë“œê°€ ìƒˆë¡œ ìƒì„±ë˜ì§€ë„ ì‚­ì œë˜ì§€ë„ ì•ŠëŠ”ë‹¤. ë˜í•œ ì¡ë„ ë‚¨ì•„ ìˆë‹¤. íŒŒë“œë‚˜ ì¡ì´ ì‚­ì œë˜ì§€ ì•Šê³  ë‚¨ì•„ ìˆìœ¼ë©´ ë¡œê·¸ì—ì„œ ì—ëŸ¬ë‚˜ ê²½ê³ ë¥¼ í™•ì¸í•  ìˆ˜ ìˆê³  ì¡ì˜ ìƒíƒœë„ ê³„ì†í•´ì„œ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

`.spec.activeDeadlineSeconds` í•„ë“œì— ì‹œê°„ì„ ì„¤ì •í•˜ë©´, ì§€ì •ëœ ì‹œê°„ì— í•´ë‹¹ ì¡ ì‹¤í–‰ì„ ê°•ì œë¡œ ëë‚´ë©´ì„œ ëª¨ë“  íŒŒë“œ ì‹¤í–‰ë„ ì¢…ë£Œí•œë‹¤.

**ğŸ§© ì¡ ì‚­ì œ**

ì¡ì„ ì‚­ì œí•˜ë©´ ê´€ë ¨ëœ íŒŒë“œë“¤ë„ ê°™ì´ ì‚­ì œëœë‹¤.

```
$ kubectl delete job ì¡ì´ë¦„
```

## ì¡ íŒ¨í„´

ì¡ì˜ ì¼ë°˜ì ì¸ ì‚¬ìš© íŒ¨í„´ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.

ì‘ì—…ë§ˆë‹¤ ì¡ì„ í•˜ë‚˜ì”© ìƒì„±í•´ ì‚¬ìš©í•˜ëŠ” ê²ƒë³´ë‹¤ëŠ” **ëª¨ë“  ì‘ì—…ì„ ê´€ë¦¬í•˜ëŠ” ì¡ í•˜ë‚˜ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.** ì¡ì„ ìƒì„±í•˜ëŠ” ì˜¤ë²„í—¤ë“œê°€ í¬ê¸° ë•Œë¬¸ì—, ì‘ì—…ì´ ë§ì•„ì§ˆìˆ˜ë¡ ì¡ í•˜ë‚˜ê°€ ì—¬ëŸ¬ê°œ ì‘ì—…ì„ ì²˜ë¦¬í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.

ì‘ì—… ê°œìˆ˜ë§Œí¼ì˜ íŒŒë“œë¥¼ ìƒì„±í•˜ëŠ” ê²ƒë³´ë‹¤ **íŒŒë“œ í•˜ë‚˜ê°€ ì—¬ëŸ¬ ê°œì˜ ì‘ì—…ì„ ì²˜ë¦¬í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.** íŒŒë“œë¥¼ ìƒì„±í•˜ëŠ” ì˜¤ë²„í—¤ë“œë„ í¬ê¸° ë•Œë¬¸ì— ì‘ì—…ì´ ë§ì•„ì§ˆìˆ˜ë¡ íŒŒë“œ í•˜ë‚˜ê°€ ì—¬ëŸ¬ ê°œ ì‘ì—…ì„ ì²˜ë¦¬í•˜ëŠ” ê²ƒì´ ìœ ë¦¬í•˜ë‹¤.

# CronJob

![cron_job](cron_job.png)

ì¡ ë¦¬ì†ŒìŠ¤ëŠ” ìƒì„±ë  ë•Œ ì¦‰ì‹œ íŒŒë“œë¥¼ ì‹¤í–‰í•œë‹¤. ê·¸ëŸ¬ë‚˜ ë§ì€ ë°°ì¹˜ ì‘ì—…ì€ ì•ìœ¼ë¡œ **íŠ¹ì • ì‹œê°„ì— ì‹¤í–‰ë˜ê±°ë‚˜ ì§€ì •ëœ ê°„ê²©ìœ¼ë¡œ ë°˜ë³µì ì¸ ì‹¤í–‰**ì´ í•„ìš”í•œ ê²½ìš°ê°€ ìˆë‹¤. ë¦¬ëˆ…ìŠ¤ ê°™ì€ OSì—ì„œ ì´ëŸ° ì‘ì—…ì€ cron ì‘ì—…ìœ¼ë¡œ ì•Œë ¤ì ¸ìˆë‹¤. k8së„ ì´ì™€ ë™ì¼í•œ ì‘ì—…ì„ ì§€ì›í•œë‹¤.

> ì¡ì„ ì‹œê°„ ê¸°ì¤€ìœ¼ë¡œ ê´€ë¦¬í•œë‹¤. ì§€ì •í•œ ì‹œê°„ì— í•œë²ˆë§Œ ì¡ì„ ì‹¤í–‰í•˜ê±°ë‚˜, ì§€ì •í•œ ì‹œê°„ë™ì•ˆ ì£¼ê¸°ì ìœ¼ë¡œ ì¡ì„ ë°˜ë³µí•˜ëŠ” ì‘ì—…ì—ì„œ ì‚¬ìš©í•œë‹¤.
>

ì„¤ì •ëœ ìŠ¤ì¼€ì¤„ì— ë”°ë¼ í¬ë¡ ì¡ì— êµ¬ì„±ëœ ì¡ í…œí”Œë¦¿ì— ë”°ë¼ ì¡ ë¦¬ì†ŒìŠ¤ë¥¼ ìƒì„±í•œë‹¤. ì¡ ë¦¬ì†ŒìŠ¤ê°€ ìƒì„±ë˜ë©´ í•˜ë‚˜ ì´ìƒì˜ íŒŒë“œ ë³µì œë³¸ì´ ìƒì„±ë˜ê³  ì¡ì˜ íŒŒë“œ í…œí”Œë¦¿ì— ë”°ë¼ ì‹œì‘ëœë‹¤. ê¸°ë³¸ì ìœ¼ë¡œ **CronJobì€ Jobê³¼ì˜ ì„¤ì •ê³¼ í¬ê²Œ ë‹¤ë¥´ì§€ ì•Šë‹¤. ë‹¤ë¥¸ ì ì€ ìŠ¤ì¼€ì¤„ë¡œ ì£¼ê¸°ë¥¼ ì„¤ì •í•˜ëŠ” ë¶€ë¶„ì´ë‹¤.**

## ë¦¬ì†ŒìŠ¤ ì •ì˜

```yaml
apiVersion: batch/v1 # API ê·¸ë£¹ì€ batchì´ë‹¤.
kind: CronJob
metadata:
  name: hello
spec:
  schedule: "*/1 * * * *"   # ë§¤ 1ë¶„ë§ˆë‹¤ ì‹¤í–‰
  jobTemplate:
    spec:
      template:
        spec:
          containers:
          - name: hello
            image: busybox:1.28
            imagePullPolicy: IfNotPresent
            command:
            - /bin/sh
            - -c
            - date; echo Hello from the Kubernetes cluster
          restartPolicy: OnFailure

```

ë§¤ 1ë¶„ë§ˆë‹¤ í˜„ì¬ ì‹œê°„ê³¼ hello ë©”ì‹œì§€ë¥¼ ì¶œë ¥í•œë‹¤.

### í¬ë¡  ìŠ¤ì¼€ì¤„ ë¬¸ë²•

```
# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ë¶„ (0 - 59)
# â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ì‹œ (0 - 23)
# â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ì¼ (1 - 31)
# â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ì›” (1 - 12)
# â”‚ â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ìš”ì¼ (0 - 6) (ì¼ìš”ì¼ë¶€í„° í† ìš”ì¼ê¹Œì§€;
# â”‚ â”‚ â”‚ â”‚ â”‚                                   íŠ¹ì • ì‹œìŠ¤í…œì—ì„œëŠ” 7ë„ ì¼ìš”ì¼)
# â”‚ â”‚ â”‚ â”‚ â”‚                                   ë˜ëŠ” sun, mon, tue, wed, thu, fri, sat
# â”‚ â”‚ â”‚ â”‚ â”‚
# * * * * *

> "2ì‹œê°„ë§ˆë‹¤"ë¼ê³  ì§€ì •í•˜ê³  ì‹¶ìœ¼ë©´, ê°„ë‹¨íˆ */2ë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤.

```

[ìŠ¤ì¼€ì¤„ ë¬¸ë²•](https://www.notion.so/c6c0db5848694693b7f646f147245165)

ì–´ë–¤ ì´ìœ ë¡œë“  í•´ë‹¹ ìŠ¤ì¼€ì¤„ ì‹œê°„ì— ì‹œì‘í•˜ì§€ ì•Šìœ¼ë©´ ì‘ì—…ì´ ì‹¤í–‰ë˜ì§€ ì•Šê³  ì‹¤íŒ¨ë¡œ í‘œì‹œëœë‹¤.

## ë¦¬ì†ŒìŠ¤ í™•ì¸

**ğŸ§© í¬ë¡  ì¡ì˜ ìŠ¤ì¼€ì¤„ ì„¤ì • í™•ì¸**

```
$ kubectl get cronjobs

NAME       SCHEDULE   		SUSPEND   ACTIVE   LAST SCHEDULE 	AGE
hello      */1 * * * *   	false     1	       11s       		15s
```

- `SUSPEND` : í¬ë¡ ì¡ì´ ì •ì§€ë˜ì—ˆëŠ”ì§€ ë‚˜íƒ€ë‚¸ë‹¤.
- `ACTIVE` : í˜„ì¬ ì‹¤í–‰ì¤‘ì¸ ì¡ì´ ìˆëŠ”ì§€ë¥¼ ë‚˜íƒ€ë‚¸ë‹¤.
- `LAST SCHEDULE` : ë§ˆì§€ë§‰ìœ¼ë¡œ ì¡ì„ ì‹¤í–‰í•œ í›„ ì–´ëŠì •ë„ ì‹œê°„ì´ ì§€ë‚¬ëŠ”ì§€ ë‚˜íƒ€ë‚¸ë‹¤.

**ğŸ§© í¬ë¡  ì¡ì´ ì‹¤í–‰í•œ ì¡ í™•ì¸**

```
$ kubectl get jobs
NAME               COMPLETIONS   DURATION   AGE
hello-4111706356   0/1                      0s
hello-4111706356   0/1           0s         0s
hello-4111706356   1/1           5s         5s
```

í¬ë¡ ì¡ ì´ë¦„ì´ hello ë’¤ì— ìˆ«ìê°€ ë¶™ì€ ì¡ë“¤ì´ ì‹¤í–‰ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

- `COMPLETIONS` : ì‘ì—…ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œí•œ íšŸìˆ˜/ì´ ì‘ì—… íšŸìˆ˜
- `DURATION` : ì‘ì—…ì„ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œí•˜ëŠ” ë° ê±¸ë¦° ì‹œê°„

## ë¦¬ì†ŒìŠ¤ ì‚­ì œ

```
$ kubectl delete cronjobs í¬ë¡ ì¡ì´ë¦„
```

í¬ë¡ ì¡ì´ ìƒì„±í–ˆë˜ ì¡ê³¼ íŒŒë“œê¹Œì§€ í•œêº¼ë²ˆì— ì‚­ì œëœë‹¤.

> ì¡(Job)ì€ 1íšŒì„± ì‘ì—…ì„ í•  ë•Œ ì‚¬ìš©í•˜ë©°, í¬ë¡ ì¡(CronJob)ì€ ì£¼ê¸°ì ì¸ ë°°ì¹˜ ì‘ì—…ì„ ì‹¤í–‰í•  ë•Œ ì‚¬ìš©í•œë‹¤.
>

**References**

- [ì±… | Kubernetes in Action 4ì¥](http://www.yes24.com/Product/Goods/89607047)
- [ì±… | ì¿ ë²„ë„¤í‹°ìŠ¤ ì…ë¬¸ - 6. ì»¨íŠ¸ë¡¤ëŸ¬](http://www.yes24.com/Product/Goods/85578606)
- [Kubernetes | ì¡](https://kubernetes.io/ko/docs/concepts/workloads/controllers/job/)
- [Kubernetes | í¬ë¡ ì¡](https://kubernetes.io/ko/docs/concepts/workloads/controllers/cron-jobs/)